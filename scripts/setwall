#!/bin/bash

# Проверяем аргументы
if [ -z "$1" ]; then
    echo "Использование: setwall <путь_к_картинке>"
    exit 1
fi

IMG_PATH="$1"

# Проверяем существование файла
if [ ! -f "$IMG_PATH" ]; then
    echo "Ошибка: Файл не найден!"
    exit 1
fi

# --- ГЛАВНОЕ ИСПРАВЛЕНИЕ ---
# Проверяем, работает ли swww-daemon. Если нет — запускаем.
if ! pgrep -x "swww-daemon" > /dev/null; then
    echo "Демон обоев не запущен. Запускаю..."
    swww-daemon &
    sleep 1 # Ждем секунду, пока он проснется
fi
# ---------------------------

echo "Устанавливаем обои..."

# 1. Копируем для Hyprlock
cp "$IMG_PATH" ~/Pictures/current_wallpaper.jpg

# 2. Ставим на рабочий стол
swww img ~/Pictures/current_wallpaper.jpg \
    --transition-type grow \
    --transition-pos 0.9,0.1 \
    --transition-step 90 \
    --transition-fps 144

# 3. Отправляем уведомление (теперь сработает)
notify-send "Обои обновлены" "Наслаждайся видом!"

echo "Готово!"
